<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/google-map/google-map.html">
<link rel="import" href="../bower_components/google-map/google-map-marker.html">
<link rel="import" href="../src/elements.html">

<dom-module id="sportal-map">

    <template>

        <style>
            :host {
                display: block;
            }

            google-map {
               height: 100vh;
               width: 100%;

            }

            #map-container {
                display: flex;
                flex-direction: row;
            }

            #filter-container {
                flex: 1 0 0;
                z-index: 1;
                padding-left: 10px;
            }

            #map-area {
                flex: 4 0 0;
            }

        </style>
        <iron-ajax id="eventGet"
                   auto
                   url="{{requestUrl}}"
                   handle-as="json"
                   on-error="_onError"
                   on-response="_onResponse"
                   content-type="application/json"
                   debounce-duration="300"
                   method="GET"
                   withCredentials
        ></iron-ajax>



            <template is="dom-if" if="{{ajaxResponse}}">
                <paper-card id="map-container">
                    <div elevation="1" id="filter-container">
                        <h4>Filters:</h4>
                        <paper-dropdown-menu label="Event Type">
                            <paper-listbox attr-for-selected="name"
                                           class="dropdown-content"
                                           selected={{eventType}}>
                                <paper-item name="pickup">Pickup Game</paper-item>
                                <paper-item name="league">League</paper-item>
                                <paper-item name="race">Run or Race</paper-item>
                            </paper-listbox>
                        </paper-dropdown-menu>
                        <h5>Location</h5>
                        <h5>Sport</h5>
                        <h5>Skill Level</h5>
                        <h5>Age</h5>
                        <!--<template is="dom-repeat" items="{{ajax}}">-->
                            <!--<h5>{{item.address.lng}}</h5>-->
                        <!--</template>-->
                    </div>
                    <div id="map-area">
                        <google-map id="map"
                                    fit-to-markers
                                    api-key="AIzaSyD0Oog2e-DQ167WD0Az9gfwaXxYvgrjdNg"
                                    single-info-window="true"
                                    latitude="45.5"
                                    longitude="-122.67"
                                    zoom="10">
                            <template is="dom-repeat" items=[[ajaxResponse]]>
                                <google-map-marker latitude=[[item.address.lat]]
                                                   longitude=[[item.address.lng]]>
                                    <h4>[[item.name]]</h4>
                                    <h5>[[item.sport]]</h5>
                                    <h5>[[item.skillLevel]]</h5>
                                </google-map-marker>
                            </template>
                        </google-map>
                    </div>
            </template>
        </paper-card>


        <!--<iron-ajax id="eventGet"-->
                   <!--auto-->
                   <!--url="http://localhost:3000/api/Events"-->
                   <!--handle-as="json"-->
                   <!--on-error="_onError"-->
                   <!--content-type="application/json"-->
                   <!--debounce-duration="300"-->
                   <!--method="GET"-->
                   <!--last-response="{{ajaxResponse}}"-->
        <!--&gt;</iron-ajax>-->

    </template>

    <script>

        Polymer({

            is: 'sportal-map',

            behaviors: [
                Polymer.IronMenuBehavior
            ],

            listeners: {
                "iron-select" : "_selectedFilter"
            },


            properties: {

                route: Object,

                ajaxResponse: {
                    type: Object
                },

                requestUrl: {
                    type: String,
                    value: "http://localhost:3000/api/Events"
                },

                eventType: {
                    value: ""
                }

            },
//
//            attached: function () {
//                console.log(this.$.map);
//                console.log(this.ajaxResponse);
//            },

            _onResponse: function (e) {
                this.ajaxResponse = e.detail.response;

                console.log(this.ajaxResponse);
//                var map = this.$.map;
//
//                map.addEventListener('dom-change', function() {
//                    console.log("dom has changed");
//                });
            },

            _selectedFilter: function() {
                var baseUrl = "http://localhost:3000/api/Events";


                var newUrl = baseUrl + "?filter[where][eventType]=" + this.eventType;
                this.requestUrl = newUrl;
                console.log(this.requestUrl);

                this.$.eventGet.generateRequest();
            }
//
//            _lastResponse: function (data) {
//                this.ajax = data.detail.response;
//
//                console.log(data);
//
//            },
//
//            _onError: function (e) {
//
//            }
        });

    </script>

</dom-module>